# Moodleと遊ぼう

実際に「ちょっと実用的かも？」と思えるクイズを作るところまでやってみます。

2024年12月頃の検証結果となります。Moodle 4.5です

問題セットとして権利関係等が多少わかりやすいので、応用情報処理試験の午前問題をサンプルとします。
PDFを加工する部分はmoodleの本質と違いますが、まぁ必要な作業なんでばばっと説明はします。

https://www.ipa.go.jp/shiken/mondai-kaiotu/2023r05.html

問題セットが要るのはわかりますが、まずmoodle本体の雰囲気から。

## まずは本家のデモサイトで感じを掴む

https://moodle.org/demo

雰囲気を確認するのに便利です。ただし、コンテンツの中身は英語だけです。

また、コースの中身は、当然ですが、本格的な学習リソースというほどの内容にはなっていません。

すべてのデモについて、1時間に1回環境がリセットされるとのこと。
既存のクイズを編集したりする操作も気軽に試せますが、じっくり実験するのには向きません。

> Each demo site is reset to its blank state every hour, on the hour. 

確認時点 (2024-12-07) では2つの例があります。

- Mount Orange School
- Moodle Sandbox

Mount Orange School は実際に学校等でe-Learningを行うケースを想定しているようです。
デモサイトとしては流石にきちんとしています。

生徒役アカウントと先生役アカウントがあるのでどう見えるのか、どう使うのかのイメージを確認しやすいです

クイズ形式のデモは一見の価値ありです。計算問題とか、一部のCAPTCHAみたいなジグソーパズル風の問題まで出してます。へぇ

![ジグソーっぽいパズル例](image-1.png)

先生役アカウントである `teacher / moodle2024` でログインの上で以下ページを見てみるのが良いです
（生徒役でも授業にEnrollすれば回答形式で内容を確認できます）

https://school.moodledemo.net/mod/quiz/attempt.php?attempt=76&cmid=1210

## エクスポート・インポートについて眺める

https://docs.moodle.org/405/en/Export_questions

問題のエクスポートもできます。Word形式にも出来るらしいですが、割愛

- Aikenフォーマット
- GIFTフォーマット
- Moodle XMLフォーマット
- XHTMLフォーマット

このレポジトリにエクスポート例を置いておきます。

外部で編集する方法の一つとして、QuEDIT があるようです。GIFT（でMoodleからエクポートされた）ファイルを理屈上取り込めます（QuEDITにインポートできます）

https://www1.hus.ac.jp/~fukai

使い勝手の評価はきちんとしていませんが、「びっくりするほどできが良い」……という感じまでは持ちませんでした。

デモサイトのエクスポート結果はそのままでは正常に取り込めません。
HTMLとか画像が混じっているのが厳しい、とか色々あるようです。

多分ですがQuEDITはあくまで簡易のツールとして、いくつかの典型的なテキストベースの問題を作るのに特化しているものかな、と。

一部はソフトの課題だと思いますが、GIFTフォーマットにも問題がある気がします。マークアップとしてちょっと変な感じ。
画像も埋め込まれてませんし。

Moodle XMLフォーマットはBASE64で画像も入っていてかなり「包括的」な感じしますが、取り扱いが簡単そうなイメージ持てないですねこれ。
QuEDITもサポートしていたりはしません。

インポートについては以下にあります

https://docs.moodle.org/405/en/Import_questions

仮に本格的に問題を管理するとした場合のことは多少意識しといたほうが良いんでしょうね。
というのも、インポート・エクスポートについてあんまり「いい感じに外部のツールとやりとりする」ことは想定していない印象を持ちます。

- Moodle内で作って、完結する
- (QuEDITのような)簡易的なツールでテストをざっと作って、Moodle内で調整する（以降外で取り扱わない）

といった感じ。e-Learningのツールで相互運用とかそういう話は多分あんまり気にしないでしょうから、ええんでしょうね。


## 手元のDockerでmoodleを動かしてみる

WSL上で試す感じでやります。

個人的な意図としては、直接Linux上にインストールするオンプレっぽい形式ではなく、コンテナでレバレッジかけたいところがちょっとあります。

他方で、この手のシステムをPaaS風にするのは多くのユースケースで「割に合わない」ってことはあるかなと。
大学での利用事例が顕著だと思うんですが、そういう場合はクラウドネイティブというよりは学内インフラの活用が先に来ることが多いでしょうし、ストレージもNFS的なのだったりするんじゃないかなーとか。

あいにくMoodle本体は生のLinuxにインストールする古典的な方法しか扱ってません。
それはそれで上記の通り妥当なんですが、まずはDockerで動かしてみます。

https://hub.docker.com/r/bitnami/moodle

何も設定しないで `docker-compose up` した場合にはローカルファイル等としては永続化されません。
とりあえずその状態で遊びます

標準設定では user/password は記述の通り `user`/`bitnami` です。admin権限です。

最初はLanguage Packが入っていないので英語インターフェースしか選べません。
選びます

![入れた](image.png)

コンテナ上のLinuxのロケールが足りない臭い感じ。

本格的に使う場合にはDBを本当にMariaDBにするのか、また永続化ファイルの置き場所はどこが良いか（PaaS想定ならS3にどう置くのか）とかが論点になるかもしれません

## 問題の準備

さてまぁ、環境の構築についてはゴールが見えそうな感じなので、実際に運用する際に作るクイズの部分の見通しをよくしときます。

ここはmoodle本体とあんまり関係ないんで、一旦このレポジトリにCSV化したものを置いておきます。どっかの合法なAIでCSV作って多少人の目で確認したものです。
正確な保証は今回の対象ではないんで、そこは期待しませんように。

また、CSVフォーマットをさくっとMoodleが取り込めるかと言うと取り込めません。
4択問題だけ取り込む都合の良い仕組みみたいのはないです。
GIFTフォーマットなりに変換する必要があるはずです。

またCSV内のテキストの正確性以外にも、この午前問題をMoodle内でフルにワークさせる場合には以下の検討も要るはずです

- 数学関連のマークアップ
- 図表

## 問題を実際にクイズとしてMoodleに取り込む

手で作成するのは、……がんばろう

まず、一問UI上で作成してエクスポートした例を以下に示します（GIFTフォーマット）

```
// question: 0  name: Switch category to $course$/top/Default for 応用情報練習
$CATEGORY: $course$/top/Default for 応用情報練習


// question: 1  name: IaC
::IaC::[html]<p>IaC (Infrastructure as Code) に関する記述として, 最も適切なものはどれか。</p>{
	~<p><span data-sheets-root\="1">インフラストラクチャの自律的なシステム運用を実現するために，インシデントへの対応手順をコードに定めること</span></p>
	~<p><span data-sheets-root\="1">各種開発支援ツールを利用するために, ビルドの手順をコードに定めること</span></p>
	~<p><span data-sheets-root\="1">継続的インテグレーションを実現するために，アプリケーションの生成手順や試験の手順をコードに定めること</span></p>
	=<p><span data-sheets-root\="1">ソフトウェアによる自動実行を可能にするために, システムの構成や状態をコードに定めること</span></p>
}
```

まぁ頑張りゃ作れますね。

（以下TBD）



## 適当な情報

- https://www1.hus.ac.jp/~fukai/ QuEDIT クイズ作成
- https://hs-learning.jp/blog/20230127/ Moodleの話（適当に探した）